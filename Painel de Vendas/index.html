<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>Vendas | RuaRoma Sunset</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root{
            --brand-red:#E63A2E;
            --brand-green:#197a3b;
            --bg-left:#071e26;
            --bg-right:#0f3a45;
            --card-bg: rgba(0,0,0,0.6);
            --muted:#cfdde6;
            --text:#ffffff;
            --accent:#2ea3ff;
        }
        html,body{height:100%;margin:0;}
        body{
            display:flex;
            align-items:center;
            justify-content:center;
            padding:32px;
            background-image: linear-gradient(90deg,var(--bg-left),var(--bg-right));
            font-family: "Inter", Arial, Helvetica, sans-serif;
            -webkit-font-smoothing:antialiased;
        }
        .box{
            width:360px;
            max-width:calc(100% - 48px);
            background:var(--card-bg);
            border-radius:15px;
            padding:18px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.6);
            color:var(--text);
        }
        .brand{ display:flex; align-items:center; justify-content:center; gap:10px; margin-bottom:12px; }
        .brand img{ max-width:220px; height:auto; display:block; }
        #brand-text{ display:none; font-family:"Pacifico",cursive; color:var(--brand-red); font-size:20px; }
        h2{ text-align:center; margin:0 0 8px 0; }
        .categorias { display:flex; gap:12px; justify-content:center; margin-bottom:12px; }
        .categoria-btn{
            border: none;
            color: #fff;
            padding:12px;
            border-radius:8px;
            width:140px;
            height:86px;
            cursor:pointer;
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center;
            gap:6px;
            background: linear-gradient(180deg, var(--brand-red), #b83228);
        }
        .categoria-icone { font-size:34px; }
        form fieldset{ border:2px solid rgba(46,163,255,0.35); padding:12px; border-radius:8px; }
        legend{ background: var(--brand-red); padding:6px 10px; border-radius:6px; color:#fff; font-family:"Pacifico",cursive; }
        .pedido-item{ display:flex; align-items:center; gap:8px; margin:8px 0; }
        .pedido-item label{ flex:1; color: #e6eef6; }
        .qtd-input{ width:60px; padding:6px; border-radius:6px; border:1px solid rgba(46,163,255,0.18); background:transparent; color:white; }
        .inputBox{ margin-top:8px; }
        .labelInput.staticLabel{ display:block; margin-bottom:6px; color:var(--muted); font-size:13px; }
        .valor-input{ width:100%; padding:8px 10px; border-radius:6px; border:1px solid rgba(46,163,255,0.14); background: rgba(0,0,0,0.15); color:#fff; font-size:18px; text-align:right; box-sizing:border-box; }
        .voltar-btn{ background:var(--brand-green); color:#fff; border:none; padding:10px 12px; border-radius:6px; cursor:pointer; }
        #submit-btn{ background-image: linear-gradient(90deg, var(--brand-red), #8f2b24); width:100%; border:none; padding:12px; color:white; font-size:16px; cursor:pointer; border-radius:8px; }
        .actions{ display:flex; gap:8px; margin-top:10px; align-items:center; }
        p.section-title{ margin:10px 0 6px 0; color:#dbeefc; }
    </style>
</head>
<body>
    <div class="box">
        <div class="brand">
            <img src="assets/logo.png" alt="RuaRoma Logo"
                 onerror="this.style.display='none'; document.getElementById('brand-text').style.display='inline-block'">
            <span id="brand-text">Vendas RuaRoma Sunset</span>
        </div>

        <div id="tela-categorias">
            <h2>Escolha uma Categoria</h2>
            <div class="categorias">
                <button class="categoria-btn" type="button" onclick="mostrarCategoria('pizzas')">
                    <span class="categoria-icone">üçï</span>
                    <span>Pizzas</span>
                </button>
                <button class="categoria-btn" type="button" onclick="mostrarCategoria('bebidas')">
                    <span class="categoria-icone">üç∏</span>
                    <span>Bebidas</span>
                </button>
            </div>
        </div>

        <form id="formulario-pedido" style="display:none;">
            <fieldset>
                <legend>Vendas RuaRoma Sunset</legend>

                <p class="section-title">Pedidos (selecione os itens desejados):</p>

                <!-- Pizzas -->
                <div class="pedido-item item-pizza">
                    <input type="checkbox" id="mussarela" name="item_pedido" value="mussarela">
                    <label for="mussarela">Mussarela - R$25,00</label>
                    <input type="number" id="qtd_mussarela" class="qtd-input" value="0" min="0" max="99">
                </div>
                <div class="pedido-item item-pizza">
                    <input type="checkbox" id="calabresa" name="item_pedido" value="calabresa">
                    <label for="calabresa">Calabresa - R$20,00</label>
                    <input type="number" id="qtd_calabresa" class="qtd-input" value="0" min="0" max="99">
                </div>
                <div class="pedido-item item-pizza">
                    <input type="checkbox" id="pepperoni" name="item_pedido" value="pepperoni">
                    <label for="pepperoni">Pepperoni - R$30,00</label>
                    <input type="number" id="qtd_pepperoni" class="qtd-input" value="0" min="0" max="99">
                </div>
                <div class="pedido-item item-pizza">
                    <input type="checkbox" id="ragu_linguica" name="item_pedido" value="ragu_linguica">
                    <label for="ragu_linguica">Rag√∫ - R$35,00</label>
                    <input type="number" id="qtd_ragu_linguica" class="qtd-input" value="0" min="0" max="99">
                </div>
                <div class="pedido-item item-pizza">
                    <input type="checkbox" id="pannacotta" name="item_pedido" value="pannacotta">
                    <label for="pannacotta">Pannacotta - R$15,00</label>
                    <input type="number" id="qtd_pannacotta" class="qtd-input" value="0" min="0" max="99">
                </div>

                <p class="section-title">Bebidas:</p>
                <div class="pedido-item item-bebida">
                    <input type="checkbox" id="cuba" name="item_pedido" value="cuba">
                    <label for="cuba">Cuba - R$20,00</label>
                    <input type="number" id="qtd_cuba" class="qtd-input" value="0" min="0" max="99">
                </div>
                <div class="pedido-item item-bebida">
                    <input type="checkbox" id="caipirinha" name="item_pedido" value="caipirinha">
                    <label for="caipirinha">Caipirinha - R$20,00</label>
                    <input type="number" id="qtd_caipirinha" class="qtd-input" value="0" min="0" max="99">
                </div>
                <div class="pedido-item item-bebida">
                    <input type="checkbox" id="mojito" name="item_pedido" value="mojito">
                    <label for="mojito">Mojito - R$25,00</label>
                    <input type="number" id="qtd_mojito" class="qtd-input" value="0" min="0" max="99">
                </div>
                <div class="pedido-item item-bebida">
                    <input type="checkbox" id="ginpesto" name="item_pedido" value="ginpesto">
                    <label for="ginpesto">GinPesto - R$25,00</label>
                    <input type="number" id="qtd_ginpesto" class="qtd-input" value="0" min="0" max="99">
                </div>
                <div class="pedido-item item-bebida">
                    <input type="checkbox" id="refrigerante" name="item_pedido" value="refrigerante">
                    <label for="refrigerante">Refrigerante - R$8,00</label>
                    <input type="number" id="qtd_refrigerante" class="qtd-input" value="0" min="0" max="99">
                </div>
                <div class="pedido-item item-bebida">
                    <input type="checkbox" id="agua" name="item_pedido" value="agua">
                    <label for="agua">√Ågua - R$5,00</label>
                    <input type="number" id="qtd_agua" class="qtd-input" value="0" min="0" max="99">
                </div>
                <div class="pedido-item item-bebida">
                    <input type="checkbox" id="chopp300" name="item_pedido" value="chopp300">
                    <label for="chopp300">Chopp 300ml - R$12,00</label>
                    <input type="number" id="qtd_chopp300" class="qtd-input" value="0" min="0" max="99">
                </div>
                <div class="pedido-item item-bebida">
                    <input type="checkbox" id="chopp500" name="item_pedido" value="chopp500">
                    <label for="chopp500">Chopp 500ml - R$18,00</label>
                    <input type="number" id="qtd_chopp500" class="qtd-input" value="0" min="0" max="99">
                </div>

                <div class="inputBox" style="margin-top:10px;">
                    <label for="valorTotalCompra" class="labelInput staticLabel">Valor Total da Compra (R$)</label>
                    <input type="text" id="valorTotalCompra" name="valorTotalCompra" class="valor-input" readonly value="0.00">
                </div>

                <div class="inputBox" style="margin-top:8px;">
                    <label for="senha_pedido" class="labelInput staticLabel">Senha do Pedido</label>
                    <input type="text" id="senha_pedido" name="senha_pedido" class="valor-input" maxlength="6" value="">
                </div>

                <div class="actions">
                    <button type="button" class="voltar-btn" onclick="voltarCategorias()">Voltar para Categorias</button>
                    <button id="submit-btn" type="submit">Enviar</button>
                </div>
            </fieldset>
        </form>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // pre√ßos
        window.precosItens = {
            mussarela:25.00, calabresa:20.00, pepperoni:30.00, ragu_linguica:35.00, pannacotta:15.00,
            cuba:20.00, caipirinha:20.00, mojito:25.00, ginpesto:25.00, refrigerante:8.00, agua:5.00,
            chopp300:12.00, chopp500:18.00
        };

        // mostrar categorias e filtrar itens
        window.mostrarCategoria = function(categoria){
            document.getElementById('tela-categorias').style.display = 'none';
            document.getElementById('formulario-pedido').style.display = 'block';
            document.querySelectorAll('.item-pizza').forEach(el => el.style.display = categoria === 'pizzas' ? 'flex' : 'none');
            document.querySelectorAll('.item-bebida').forEach(el => el.style.display = categoria === 'bebidas' ? 'flex' : 'none');
        };
        window.voltarCategorias = function(){
            document.getElementById('tela-categorias').style.display = 'block';
            document.getElementById('formulario-pedido').style.display = 'none';
            // reset opcional: document.getElementById('formulario-pedido').reset();
        };

        // c√°lculo autom√°tico do valor total
        const inputValorTotal = document.getElementById('valorTotalCompra');
        function atualizarValorTotal(){
            const checkboxes = document.querySelectorAll('input[name="item_pedido"]');
            let total = 0;
            checkboxes.forEach(cb => {
                const key = cb.value;
                const qtdEl = document.getElementById('qtd_' + key);
                const qtd = qtdEl ? parseInt(qtdEl.value, 10) || 0 : 0;
                if (qtd > 0) cb.checked = true;
                if (!cb.checked) return;
                const preco = Number(window.precosItens[key] || 0);
                total += preco * qtd;
            });
            inputValorTotal.value = total.toFixed(2);
        }

        // ouvintes para checkboxes e quantidades
        document.querySelectorAll('input[name="item_pedido"]').forEach(cb => {
            cb.addEventListener('change', () => {
                const key = cb.value;
                const qtdEl = document.getElementById('qtd_' + key);
                if (cb.checked && qtdEl && (qtdEl.value === '' || Number(qtdEl.value) === 0)) qtdEl.value = 1;
                if (!cb.checked && qtdEl) qtdEl.value = 0;
                atualizarValorTotal();
            });
        });
        document.querySelectorAll('.qtd-input').forEach(q => {
            q.addEventListener('input', () => {
                const key = q.id.replace(/^qtd_/, '');
                const cb = document.querySelector('input[name="item_pedido"][value="'+key+'"]');
                const val = parseInt(q.value, 10) || 0;
                if (cb) cb.checked = val > 0;
                atualizarValorTotal();
            });
        });
        atualizarValorTotal();

        // submit -> gera 1 PDF √∫nico com 1 p√°gina por unidade, produto em destaque grande
        const form = document.getElementById('formulario-pedido');
        if (form) {
            form.addEventListener('submit', function(e){
                e.preventDefault();
                const jsPDFLib = (window.jspdf && window.jspdf.jsPDF) || window.jsPDF;
                if (!jsPDFLib) { alert('Erro: jsPDF n√£o carregado.'); return; }

                const senha = document.getElementById('senha_pedido')?.value || Date.now().toString();

                const itensSelecionados = Array.from(document.querySelectorAll('input[name="item_pedido"]'))
                    .map(cb => {
                        const key = cb.value;
                        const qtd = parseInt(document.getElementById('qtd_' + key)?.value || '0', 10) || 0;
                        const label = document.querySelector('label[for="'+cb.id+'"]');
                        const nomeItem = label ? label.textContent.split('-')[0].trim() : key;
                        return { key, nomeItem, qtd };
                    })
                    .filter(it => it.qtd > 0);

                if (itensSelecionados.length === 0) {
                    alert('Nenhum item com quantidade selecionada.');
                    return;
                }

                try {
                    // Configura PDF no formato cupom (80mm x 150mm em pontos ~ 226.77 x 425.20)
                    const doc = new jsPDFLib({
                        unit: 'mm',
                        format: [80, 150],  // largura: 80mm (padr√£o cupom fiscal)
                        orientation: 'portrait'
                    });
                    
                    // Margens laterais
                    const marginLeft = 5;  // 5mm de margem
                    const pageWidth = doc.internal.pageSize.getWidth();
                    let pageIndex = 0;

                    itensSelecionados.forEach(it => {
                        for (let u = 1; u <= it.qtd; u++) {
                            if (pageIndex > 0) doc.addPage();
                            pageIndex++;

                            // Cabe√ßalho centralizado (marca)
                            doc.setFontSize(12);
                            const marca = 'RuaRoma Sunset';
                            const marcaW = doc.getTextWidth(marca);
                            doc.text(marca, (pageWidth - marcaW) / 2, 10);

                            // "VALE" em destaque centralizado
                            doc.setFontSize(32);  // reduzido para caber na largura
                            try { doc.setFont(undefined, 'bold'); } catch(e){}
                            const valeText = 'VALE';
                            const valeW = doc.getTextWidth(valeText);
                            doc.text(valeText, (pageWidth - valeW) / 2, 30);

                            // Texto do vale - produto alinhado √† esquerda
                            const textoVale = `Vale 1x ${it.nomeItem}`;
                            doc.setFontSize(16);
                            try { doc.setFont(undefined, 'bold'); } catch(e){}
                            doc.text(textoVale, marginLeft, 45);

                            // Informa√ß√µes extras alinhadas √† esquerda
                            doc.setFontSize(8);
                            try { doc.setFont(undefined, 'normal'); } catch(e){}
                            doc.text(`Unidade: ${u} de ${it.qtd}`, marginLeft, 55);
                            doc.text(`Senha: ${senha}`, marginLeft, 60);
                            doc.text(`Emitido: ${new Date().toLocaleString('pt-BR')}`, marginLeft, 65);
                        }
                    });

                    const filename = `vales-${senha}.pdf`;
                    doc.save(filename);
                    alert(`PDF gerado com ${pageIndex} p√°gina(s): ${filename}`);
                } catch (err) {
                    console.error('Erro ao gerar PDF:', err);
                    alert('Erro ao gerar PDF. Veja o console para detalhes.');
                }
            });
        }
    });
    </script>
</body>
</html>